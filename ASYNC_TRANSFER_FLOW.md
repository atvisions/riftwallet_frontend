# 异步转账流程说明

## 🚀 新的转账用户体验

### 1. **转账提交**
- 用户在Send页面填写转账信息并提交
- 前端立即跳转到首页，无需等待区块链确认
- 显示"转账处理中"的状态提示

### 2. **状态显示**
- **Pending状态**: 蓝色背景 + 旋转加载图标
- **Success状态**: 绿色背景 + 成功图标
- **Failed状态**: 红色背景 + 失败图标

### 3. **自动状态更新**
- 每3秒轮询一次交易状态
- 当状态变为success/failed时：
  - 自动刷新钱包余额
  - 启动3秒倒计时自动关闭
  - 显示倒计时："自动关闭 3s"

### 4. **用户交互**
- 用户可以手动点击关闭按钮
- 倒计时结束后自动关闭状态提示
- 关闭后清除本地存储的交易信息

## 🔧 技术实现

### 前端修改

#### Send.vue
- `handleSend()`: 转账提交后立即跳转首页
- 将交易信息存储到localStorage
- 包含transaction_id用于状态查询

#### HomeSidePanel.vue
- 新增交易状态提示组件
- 轮询交易状态（3秒间隔）
- 自动刷新钱包余额
- 倒计时自动关闭

### 后端支持

#### 异步转账流程
1. API立即返回pending状态和transaction_id
2. 后台Celery任务处理真实转账
3. 更新数据库中的交易状态
4. 前端通过transaction_history API查询状态

#### 状态检查
- 支持通过transaction_id查询
- 支持通过transaction_hash查询
- 自动失败检测（30分钟超时）

## 📱 用户体验流程

```
用户填写转账信息
       ↓
点击发送按钮
       ↓
立即跳转首页 (无等待)
       ↓
显示蓝色"处理中"提示
       ↓
每3秒检查状态
       ↓
状态变为成功/失败
       ↓
显示绿色/红色提示
       ↓
自动刷新余额
       ↓
3秒倒计时关闭
```

## 🎨 视觉效果

### 状态颜色
- **Pending**: 蓝色渐变 (#1e40af → #3b82f6)
- **Success**: 绿色渐变 (#059669 → #10b981)  
- **Failed**: 红色渐变 (#dc2626 → #ef4444)

### 动画效果
- 加载状态：旋转动画
- 出现动画：slideInDown
- 倒计时数字变化

## 🔄 自动刷新机制

转账成功后会自动触发：
1. 调用`walletStore.refreshWalletBalance()`
2. 更新代币余额和价格
3. 刷新总余额显示
4. 用户看到最新的余额信息

这样用户就能立即看到转账后的余额变化，无需手动刷新。
