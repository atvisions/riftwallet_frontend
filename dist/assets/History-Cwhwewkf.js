import{a as V}from"./preload-helper-D1eRigLN.js";import{A as W,h as B}from"./chrome-mock-0jeXDaAI.js";import{R as q}from"./ResponsiveLayout-sFjR_nb-.js";import{d as J,r as f,c as y,o as X,g as Z,F as E,f as l,i as s,e as r,G as v,C as x,H as T,I as F,n as h}from"./auth-BwimyXkQ.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"page-header"},te={class:"header-left"},se={class:"header-right"},oe={class:"filter-funnel"},ne={key:0,class:"filter-menu"},ae=["onClick"],le=["disabled"],re={class:"page-content"},ie={key:0,class:"loading-state"},ue={key:1,class:"empty-state"},ce={key:2,class:"error-state"},de={key:3,class:"transactions-list"},fe={class:"date-header"},ve=["onClick"],ge={class:"transaction-icon"},me={class:"icon-container"},pe=["src","alt"],he={key:1,class:"default-icon"},_e={key:0,class:"ri-arrow-up-line"},we={key:1,class:"ri-arrow-down-line"},ye={key:2,class:"ri-exchange-line"},ke={class:"transaction-info"},be={class:"transaction-main"},Ce={class:"transaction-header"},Te={class:"transaction-type"},Fe={class:"transaction-details"},$e={class:"transaction-address"},Le={class:"transaction-meta"},Se={class:"transaction-time"},De={key:0,class:"loading-more"},Ae={key:1,class:"no-more"},Ne=10,Be=J({__name:"History",setup(Ee){const M=V(),u=f([]),g=f(!1),_=f(""),k=f(1),$=f(0),m=f(!1),L=y(()=>u.value.length>=$.value),p=f("all"),w=f(!1),U=[{label:"All",value:"all"},{label:"Sent",value:"sent"},{label:"Received",value:"received"}],I=e=>{p.value=e,w.value=!1},b=y(()=>p.value==="all"?u.value:p.value==="sent"?u.value.filter(e=>d(e).toLowerCase()==="sent"):p.value==="received"?u.value.filter(e=>d(e).toLowerCase()==="received"):u.value),c=y(()=>M.currentWallet),H=y(()=>{if(!b.value||b.value.length===0)return{};const e={};return b.value.forEach(t=>{const o=t.block_time||t.timestamp||t.created_at,a=Y(o);e[a]||(e[a]=[]),e[a].push(t)}),e}),C=async(e=!1)=>{if(c.value&&!(g.value||m.value)){e?m.value=!0:g.value=!0,_.value="";try{const t=await fetch(`${W.API_BASE_URL}/wallets/${c.value.id}/transaction_history/?page=${k.value}&limit=${Ne}`,{method:"GET",headers:{"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw new Error(o.message||"Failed to fetch transactions");$.value=o.total||0,e?u.value=[...u.value,...o.transactions||o||[]]:u.value=o.transactions||o||[]}catch(t){_.value=t instanceof Error?t.message:"Failed to load transactions",console.error("Failed to fetch transactions:",t)}finally{e?m.value=!1:g.value=!1}}},O=e=>{const t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<60&&!m.value&&!L.value&&(k.value++,C(!0))},S=()=>{k.value=1,C()},Y=e=>{if(!e)return"Unknown date";const t=new Date(typeof e=="number"?e*1e3:e),o=new Date,a=new Date(o.getFullYear(),o.getMonth(),o.getDate()),n=new Date(a.getTime()-24*60*60*1e3),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i.getTime()===a.getTime()?"Today":i.getTime()===n.getTime()?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==o.getFullYear()?"numeric":void 0})},D=e=>{if(e.token_logo&&e.token_logo.trim())return e.token_logo;const t=e.token_symbol||e.symbol||c.value?.chain;return t&&{SOL:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",ETH:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/info/logo.png",BNB:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/smartchain/info/logo.png",BASE:"/icons/icon128.png",KDA:"/icons/icon128.png",MATIC:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/polygon/info/logo.png",AVAX:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/avalanchec/info/logo.png",FTM:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/fantom/info/logo.png",USDC:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",USDT:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB/logo.png",BONK:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263/logo.png"}[t.toUpperCase()]||"/icons/icon128.png"},A=e=>e.token_symbol||e.symbol||c.value?.chain||"TOKEN",d=e=>e.type?e.type.charAt(0).toUpperCase()+e.type.slice(1):e.from_address&&c.value?e.from_address.toLowerCase()===c.value.address.toLowerCase()?"Sent":"Received":"Transaction",R=e=>{const t=e.target;t.src="/icons/icon128.png"},z=e=>{switch(d(e).toLowerCase()){case"send":return"amount-negative";case"receive":return"amount-positive";default:return"amount-neutral"}},G=e=>{const t=d(e),o=A(e);if(e.amount&&e.amount.toString().includes("Fee:"))return e.amount;if(e.amount&&e.amount!=="0"&&!isNaN(parseFloat(e.amount))){const a=parseFloat(e.amount),n=t.toLowerCase()==="sent"?"-":t.toLowerCase()==="received"?"+":"";let i="";return a>=.001?i=a.toFixed(6).replace(/\.?0+$/,""):a>0?i=a.toFixed(9).replace(/\.?0+$/,""):i="0",`${n}${i} ${o}`}if(e.value&&e.value!=="0"&&!isNaN(parseFloat(e.value))){const a=parseFloat(e.value),n=t.toLowerCase()==="sent"?"-":t.toLowerCase()==="received"?"+":"";let i="";return a>=.001?i=a.toFixed(6).replace(/\.?0+$/,""):a>0?i=a.toFixed(9).replace(/\.?0+$/,""):i="0",`${n}${i} ${o}`}return e.fee&&c.value?.chain==="SOL"?`Fee: ${(e.fee/1e9).toFixed(6)} SOL`:`0 ${o}`},P=e=>{if(!c.value)return"";if(e.signature&&c.value?.chain==="SOL")return B(e.signature);const t=d(e);let o="";return t.toLowerCase()==="send"?o=e.to_address||e.recipient||"":o=e.from_address||e.sender||"",o?B(o):"Unknown"},j=e=>{if(!e)return"Unknown time";const t=new Date(typeof e=="number"?e*1e3:e);if(isNaN(t.getTime()))return"Unknown time";const a=new Date().getTime()-t.getTime(),n=Math.floor(a/(1e3*60)),i=Math.floor(a/(1e3*60*60)),N=Math.floor(a/(1e3*60*60*24));return n<1?"Just now":n<60?`${n}m ago`:i<24?`${i}h ago`:N<7?`${N}d ago`:t.toLocaleDateString()},K=e=>{console.log("View transaction detail:",e)};return X(()=>{c.value&&C()}),(e,t)=>(l(),Z(q,{title:"Transaction History","show-header":!0,"show-footer":!1,scrollable:!0,onBack:t[2]||(t[2]=o=>e.$router.go(-1)),onScroll:O},{header:E(()=>[s("div",ee,[s("div",te,[s("button",{onClick:t[0]||(t[0]=o=>e.$router.go(-1)),class:"back-button"},t[3]||(t[3]=[s("i",{class:"ri-arrow-left-line"},null,-1)])),t[4]||(t[4]=s("h1",{class:"header-title"},"Transaction History",-1))]),s("div",se,[s("div",oe,[s("button",{class:"funnel-btn",onClick:t[1]||(t[1]=o=>w.value=!w.value)},t[5]||(t[5]=[s("i",{class:"ri-filter-3-line"},null,-1)])),w.value?(l(),r("div",ne,[(l(),r(T,null,F(U,o=>s("div",{key:o.value,class:h(["filter-menu-item",{active:p.value===o.value}]),onClick:a=>I(o.value)},v(o.label),11,ae)),64))])):x("",!0)]),s("button",{onClick:S,disabled:g.value,class:"refresh-button"},[s("i",{class:h(["ri-refresh-line",{spinning:g.value}])},null,2)],8,le)])])]),default:E(()=>[s("div",re,[g.value&&u.value.length===0?(l(),r("div",ie,t[6]||(t[6]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Loading transactions...",-1)]))):!g.value&&u.value.length===0?(l(),r("div",ue,t[7]||(t[7]=[s("i",{class:"ri-history-line"},null,-1),s("h2",null,"No Transactions",-1),s("p",null,"Your transaction history will appear here",-1)]))):_.value?(l(),r("div",ce,[t[8]||(t[8]=s("i",{class:"ri-error-warning-line"},null,-1)),t[9]||(t[9]=s("h2",null,"Failed to Load",-1)),s("p",null,v(_.value),1),s("button",{onClick:S,class:"retry-button"}," Try Again ")])):(l(),r("div",de,[(l(!0),r(T,null,F(H.value,(o,a)=>(l(),r("div",{key:a,class:"transaction-group"},[s("div",fe,v(a),1),(l(!0),r(T,null,F(o,n=>(l(),r("div",{key:n.signature||n.id,class:"transaction-item",onClick:i=>K(n)},[s("div",ge,[s("div",me,[D(n)?(l(),r("img",{key:0,src:D(n),alt:A(n),class:"token-icon",onError:R},null,40,pe)):(l(),r("div",he,t[10]||(t[10]=[s("i",{class:"ri-coins-line"},null,-1)])))]),s("div",{class:h(["transaction-type-indicator",{"type-sent":d(n).toLowerCase()==="sent","type-received":d(n).toLowerCase()==="received"}])},[d(n).toLowerCase()==="sent"?(l(),r("i",_e)):d(n).toLowerCase()==="received"?(l(),r("i",we)):(l(),r("i",ye))],2)]),s("div",ke,[s("div",be,[s("div",Ce,[s("div",Te,v(d(n)),1),s("div",{class:h(["transaction-amount",z(n)])},v(G(n)),3)]),s("div",Fe,[s("div",$e,v(P(n)),1),s("div",Le,[s("span",Se,v(j(n.block_time||n.timestamp||n.created_at)),1),s("span",{class:h(["status-badge",{"status-success":n.status==="success","status-failed":n.status==="failed","status-pending":n.status==="pending","status-unknown":!["success","failed","pending"].includes(n.status)}])},v(n.status?n.status.charAt(0).toUpperCase()+n.status.slice(1):"Unknown"),3)])])])])],8,ve))),128))]))),128)),m.value?(l(),r("div",De,"Loading more...")):L.value&&u.value.length>0?(l(),r("div",Ae,"No more records")):x("",!0)]))])]),_:1}))}}),Oe=Q(Be,[["__scopeId","data-v-48949b06"]]);export{Oe as default};
