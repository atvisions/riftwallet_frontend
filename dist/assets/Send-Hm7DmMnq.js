import{d as M,u as G,r as d,c as y,w as H,o as q,e as n,m as K,i as a,C as p,G as u,n as $,H as Q,I as z,A as g,E as S,f as r}from"./auth-DRfzTYJF.js";import{a as J,u as X}from"./preload-helper-DtVLuan9.js";import{C as B,A as E,j as R}from"./chrome-mock-0jeXDaAI.js";import{P as Y}from"./PageHeader-B6QzkLIr.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"send-page"},ae={class:"content"},se={class:"selection-container"},te={class:"token-section"},le={key:0,class:"selected-token"},oe={class:"token-icon"},ne=["src","alt"],re={key:1,class:"token-fallback"},ie={class:"token-info"},ue={class:"token-symbol"},ce={class:"token-balance"},de={key:1,class:"token-placeholder"},ve={key:0,class:"token-list"},_e=["onClick"],fe={class:"token-icon"},pe=["src","alt","onError"],me={key:1,class:"token-fallback"},he={class:"token-info"},ke={class:"token-symbol"},be={class:"token-name"},ye={class:"token-balance"},we={class:"address-section"},ge={class:"input-container"},Se={class:"transfer-container"},Ee={class:"amount-section"},Te={class:"amount-container"},Ae=["disabled"],Fe={key:0,class:"amount-usd"},Ce={key:0,class:"fee-section"},Ie={class:"fee-row"},Pe={class:"password-section"},Ne={key:1,class:"error-message"},$e=["disabled"],Be={key:0,class:"button-content"},Re={key:1,class:"button-content"},xe=M({__name:"Send",setup(Le){const T=X(),v=J(),A=G(),f=d(!1),l=d(null),c=d(""),i=d(""),m=d(""),h=d(""),k=d(!1),b=d(""),o=y(()=>v.currentWallet),F=y(()=>o.value?(v.currentWalletTokens||[]).filter(e=>parseFloat(e.balance)>0):[]),w=y(()=>{if(!o.value)return[];const s=v.currentWalletTokens||[],e=V();return s.some(_=>_.token_address===e.token_address)?s:[e,...s]}),C=y(()=>l.value&&c.value.trim()&&i.value&&parseFloat(i.value)>0&&m.value.trim()&&parseFloat(i.value)<=parseFloat(l.value?.balance||"0")&&parseFloat(l.value?.balance||"0")>0),x=()=>{if(!o.value)return"";const s=o.value.chain;return B[s]?.nativeSymbol||s},I=s=>{const e=parseFloat(s.toString());return e===0?"0":e<1e-6?"< 0.000001":e<1?e.toFixed(6):e<1e3?e.toFixed(4):e.toLocaleString()},L=()=>!l.value||!i.value?"0.00":(parseFloat(i.value)*(l.value.price_usd||0)).toFixed(2),V=()=>{if(!o.value)return null;const s=o.value.chain,e=B[s];if(!e)return null;let t="";return s==="SOL"?t="So11111111111111111111111111111111111111112":s==="KDA"&&(t=""),{token_address:t,symbol:e.symbol,name:e.name,decimals:e.decimals,balance:"0",balance_usd:"0",price_usd:"0",price_change_24h:"0",logo_url:`https://www.riftwallet.io/media/chain_logos/${s.toLowerCase()}.png`,is_visible:!0,imageError:!1}},P=s=>{s.imageError=!0},D=s=>{parseFloat(s.balance)!==0&&(l.value=s,f.value=!1,h.value="",c.value&&i.value&&N())},U=()=>{l.value&&(i.value=l.value.balance)},W=()=>{console.log("Scan QR code")},N=async()=>{if(!(!o.value||!c.value||!i.value))try{const s=new URLSearchParams({to_address:c.value,amount:i.value}),e=await fetch(`${E.API_BASE_URL}${R.ESTIMATE_FEE(o.value.id)}?${s}`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();e.ok&&(h.value=t.estimated_fee||t.fee||"0")}catch(s){console.error("Failed to estimate fee:",s)}},O=async()=>{if(!(!C.value||!o.value)){k.value=!0,b.value="";try{if(!A.deviceId)throw new Error("Device ID not found");const s={to_address:c.value.trim(),amount:i.value,token_address:l.value.token_address||"",payment_password:m.value,device_id:A.deviceId};o.value.chain==="KDA"&&(s.kadena_chain_id=o.value.kadena_chain_id||"1");const e=await fetch(`${E.API_BASE_URL}${R.TRANSFER(o.value.id)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await e.json();if(!e.ok)throw new Error(t.message||"Transfer failed");console.log("Transfer successful, refreshing wallet balances...");try{(await fetch(`${E.API_BASE_URL}/api/v1/wallets/${o.value.id}/refresh_balances/`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok?(console.log("API refresh successful, now updating local data..."),await v.loadWalletBalance(o.value.id),console.log("Local wallet data updated successfully")):(console.warn("Failed to refresh wallet balances via API, but transfer was successful"),await v.loadWalletBalance(o.value.id))}catch(_){console.warn("Error refreshing wallet balances:",_);try{await v.loadWalletBalance(o.value.id)}catch(j){console.error("Failed to reload local wallet data:",j)}}T.push("/")}catch(s){b.value=s instanceof Error?s.message:"Transfer failed"}finally{k.value=!1}}};return H([c,i],()=>{l.value&&c.value&&i.value&&N()}),q(()=>{if(!o.value){T.push("/");return}F.value.length>0?l.value=F.value[0]:w.value.length>0&&(l.value=w.value[0])}),(s,e)=>(r(),n("div",ee,[K(Y,{title:"Send Transaction"}),a("div",ae,[a("div",se,[a("div",te,[e[5]||(e[5]=a("label",null,"Select Token",-1)),a("div",{class:"token-selector",onClick:e[1]||(e[1]=t=>f.value=!f.value)},[l.value?(r(),n("div",le,[a("div",oe,[l.value.logo_url&&!l.value.imageError?(r(),n("img",{key:0,src:l.value.logo_url,alt:l.value.symbol,onError:e[0]||(e[0]=t=>P(l.value))},null,40,ne)):(r(),n("div",re,u(l.value.symbol.charAt(0)),1))]),a("div",ie,[a("div",ue,u(l.value.symbol),1),a("div",ce,u(I(l.value.balance)),1)])])):(r(),n("div",de," Choose a token ")),a("i",{class:$(["ri-arrow-down-s-line dropdown-icon",{rotated:f.value}])},null,2)]),f.value?(r(),n("div",ve,[(r(!0),n(Q,null,z(w.value,t=>(r(),n("div",{key:t.token_address||"native",class:$(["token-item",{disabled:parseFloat(t.balance)===0}]),onClick:_=>D(t)},[a("div",fe,[t.logo_url&&!t.imageError?(r(),n("img",{key:0,src:t.logo_url,alt:t.symbol,onError:_=>P(t)},null,40,pe)):(r(),n("div",me,u(t.symbol.charAt(0)),1))]),a("div",he,[a("div",ke,u(t.symbol),1),a("div",be,u(t.name),1)]),a("div",ye,u(I(t.balance)),1)],10,_e))),128))])):p("",!0)]),a("div",we,[e[7]||(e[7]=a("label",null,"To Address",-1)),a("div",ge,[g(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),type:"text",placeholder:"Enter recipient address",class:"input-field"},null,512),[[S,c.value]]),a("button",{class:"scan-btn",onClick:W},e[6]||(e[6]=[a("i",{class:"ri-qr-scan-line"},null,-1)]))])])]),a("div",Se,[a("div",Ee,[e[8]||(e[8]=a("label",null,"Amount",-1)),a("div",Te,[g(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>i.value=t),type:"number",step:"any",placeholder:"0.00",class:"amount-input",disabled:!l.value||parseFloat(l.value.balance)===0},null,8,Ae),[[S,i.value]]),l.value&&parseFloat(l.value.balance)>0?(r(),n("button",{key:0,onClick:U,class:"max-btn"}," MAX ")):p("",!0)]),l.value&&i.value?(r(),n("div",Fe," â‰ˆ $"+u(L()),1)):p("",!0)]),h.value?(r(),n("div",Ce,[a("div",Ie,[e[9]||(e[9]=a("span",null,"Estimated Fee",-1)),a("span",null,u(h.value)+" "+u(x()),1)])])):p("",!0),a("div",Pe,[e[10]||(e[10]=a("label",null,"Payment Password",-1)),g(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),type:"password",placeholder:"Enter your payment password",class:"input-field"},null,512),[[S,m.value]])]),b.value?(r(),n("div",Ne,u(b.value),1)):p("",!0),a("button",{onClick:O,disabled:!C.value||k.value,class:"send-button"},[k.value?(r(),n("div",Be,e[11]||(e[11]=[a("div",{class:"loading-spinner"},null,-1),a("span",null,"Sending...",-1)]))):(r(),n("div",Re,e[12]||(e[12]=[a("i",{class:"ri-send-plane-line"},null,-1),a("span",null,"Send Transaction",-1)])))],8,$e)])])]))}}),je=Z(xe,[["__scopeId","data-v-e5f448ed"]]);export{je as default};
