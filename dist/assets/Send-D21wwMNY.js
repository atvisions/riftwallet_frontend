import{d as le,u as oe,r as _,c as f,w as G,o as ie,e as l,m as re,i as s,C as v,G as r,n as E,H as N,I as F,A as I,E as P,D as de,f as o}from"./auth-6eK4OsPi.js";import{a as ce,u as ue}from"./auth-handler-CmfhYZP0.js";import{C as H,A as q,j as z}from"./chrome-mock-BbAbqiJG.js";import{P as ve}from"./PageHeader-S_2U60ij.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"send-page"},me={class:"content"},fe={class:"selection-container"},pe={class:"token-section"},ke={key:0,class:"selected-token"},ge={class:"token-icon"},ye=["src","alt"],be={key:1,class:"token-fallback"},Ce={class:"token-info"},Te={class:"token-symbol"},Se={class:"token-balance"},we={key:1,class:"token-placeholder"},Ae={key:0,class:"token-dropdown"},Ee=["onClick"],Ne={class:"token-icon"},Fe=["src","alt","onError"],Ie={key:1,class:"token-fallback"},$e={class:"token-info"},De={class:"token-symbol"},xe={class:"token-name"},Oe={class:"token-balance"},Pe={class:"address-section"},Le={class:"input-container"},Ke={key:0,class:"address-book-dropdown"},Ue={key:0,class:"address-group"},Ve=["onClick"],Be={class:"address-icon"},Je=["src","alt"],Re={class:"address-info"},Me={class:"address-name"},We={class:"address-value"},je={key:1,class:"address-group"},Ge=["onClick"],He={class:"address-icon"},qe={class:"address-fallback"},ze={class:"address-info"},Xe={class:"address-name"},Qe={class:"address-value"},Ye={key:2,class:"empty-state"},Ze={class:"transfer-container"},es={class:"amount-section"},ss={class:"amount-container"},as=["disabled"],ts={key:0,class:"amount-usd"},ns={key:0,class:"crosschain-section"},ls={class:"crosschain-toggle"},os={class:"toggle-label"},is={key:0,class:"target-chain-section"},rs={class:"selected-chain"},ds={class:"chain-info"},cs={class:"chain-label"},us={class:"chain-desc"},vs={key:0,class:"chain-dropdown"},_s=["onClick"],hs={class:"chain-info"},ms={class:"chain-label"},fs={class:"chain-desc"},ps={key:0,class:"ri-check-line"},ks={key:1,class:"fee-section"},gs={class:"fee-row"},ys={class:"password-section"},bs={key:2,class:"error-message"},Cs=["disabled"],Ts="/icons/icon128.png",Ss=le({__name:"Send",setup(ws){const L=ue(),T=ce(),K=oe(),p=_(!1),k=_(!1),g=_(!1),n=_(null),$=_(0),y=_(!1),m=_(0),u=_(""),d=_(""),S=_(""),b=_(""),w=_(""),i=f(()=>T.currentWallet),U=f(()=>i.value?.chain==="KDA"||i.value?.chain==="KDA_TESTNET"),C=f(()=>U.value?Array.from({length:20},(e,a)=>a).filter(e=>e!==$.value):[]),V=f(()=>i.value?(T.currentWalletTokens||[]).filter(e=>parseFloat(e.balance)>0):[]),D=f(()=>{if(!i.value)return[];const t=T.currentWalletTokens||[],e=Y();return t.some(c=>c.token_address===e.token_address)?t:[e,...t]}),B=f(()=>n.value&&u.value.trim()&&d.value&&parseFloat(d.value)>0&&S.value.trim()&&parseFloat(d.value)<=parseFloat(n.value?.balance||"0")&&parseFloat(n.value?.balance||"0")>0),x=f(()=>i.value?T.wallets.filter(t=>t.chain===i.value.chain&&t.id!==i.value.id):[]),O=f(()=>{if(!i.value)return[];const t=`recent_addresses_${i.value.chain}`,e=localStorage.getItem(t);if(e)try{return JSON.parse(e).slice(0,5)}catch{return[]}return[]}),X=()=>{if(!i.value)return"";const t=i.value.chain;return H[t]?.nativeSymbol||t},J=t=>{const e=parseFloat(t.toString());return e===0?"0":e<1e-6?"< 0.000001":e<1?e.toFixed(6):e<1e3?e.toFixed(4):e.toLocaleString()},Q=()=>!n.value||!d.value?"0.00":(parseFloat(d.value)*(n.value.price_usd||0)).toFixed(2),Y=()=>{if(!i.value)return null;const t=i.value.chain,e=H[t];if(!e)return null;let a="";return t==="SOL"?a="So11111111111111111111111111111111111111112":t==="KDA"&&(a=""),{token_address:a,symbol:e.symbol,name:e.name,decimals:e.decimals,balance:"0",balance_usd:"0",price_usd:"0",price_change_24h:"0",logo_url:`https://www.riftwallet.io/media/chain_logos/${t.toLowerCase()}.png`,is_visible:!0,imageError:!1}},R=t=>{t.imageError=!0},Z=t=>{parseFloat(t.balance)!==0&&(n.value=t,p.value=!1,b.value="",u.value&&d.value&&A())},ee=t=>{m.value=t,k.value=!1,b.value="",n.value&&u.value&&d.value&&A()},se=()=>{n.value&&(d.value=n.value.balance)},M=(t,e)=>{u.value=t,g.value=!1},W=t=>t?t.length<=12?t:`${t.slice(0,6)}...${t.slice(-6)}`:"",ae=(t,e)=>{if(!i.value||!t)return;const a=`recent_addresses_${i.value.chain}`,c=localStorage.getItem(a);let h=[];if(c)try{h=JSON.parse(c)}catch{h=[]}h=h.filter(j=>j.address!==t),h.unshift({address:t,name:"",timestamp:Date.now()}),h=h.slice(0,10),localStorage.setItem(a,JSON.stringify(h))},A=async()=>{if(!(!i.value||!u.value||!d.value))try{const t=new URLSearchParams({to_address:u.value,amount:d.value}),e=await fetch(`${q.API_BASE_URL}${z.ESTIMATE_FEE(i.value.id)}?${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){const a=await e.json();b.value=a.estimated_fee||a.fee||"0"}else console.warn("Failed to estimate fee:",e.status,e.statusText)}catch(t){console.error("Failed to estimate fee:",t)}},te=async()=>{if(!(!B.value||!i.value)){w.value="";try{if(!K.deviceId)throw new Error("Device ID not found");const t={to_address:u.value.trim(),amount:d.value,token_address:n.value.token_address||"",payment_password:S.value,device_id:K.deviceId};(i.value.chain==="KDA"||i.value.chain==="KDA_TESTNET")&&(t.kadena_chain_id=$.value,y.value&&(t.target_chain_id=m.value)),ae(u.value.trim());const e={status:"pending",transaction_hash:"pending_"+Date.now(),message:"转账已提交，正在处理中...",from_address:i.value.address,to_address:u.value.trim(),amount:d.value,token_symbol:n.value.symbol,chain:i.value.chain,timestamp:Date.now(),kadena_chain_id:t.kadena_chain_id,target_chain_id:t.target_chain_id};localStorage.setItem("pending_transaction",JSON.stringify(e)),L.push("/"),fetch(`${q.API_BASE_URL}${z.TRANSFER(i.value.id)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async a=>{if(a.ok){const c=await a.json(),h={...e,transaction_hash:c.transaction_hash||c.temp_hash||e.transaction_hash,task_id:c.task_id,transaction_id:c.transaction_id};localStorage.setItem("pending_transaction",JSON.stringify(h))}else{const c={...e,status:"failed",message:"转账提交失败"};localStorage.setItem("pending_transaction",JSON.stringify(c))}}).catch(a=>{const c={...e,status:"failed",message:"网络错误，转账失败"};localStorage.setItem("pending_transaction",JSON.stringify(c))})}catch(t){w.value=t instanceof Error?t.message:"Transfer failed"}}};G([u,d],()=>{n.value&&u.value&&d.value&&A()}),G(y,t=>{t?C.value.length>0&&(m.value=C.value[0]):m.value=0,n.value&&u.value&&d.value&&A()}),ie(()=>{if(!i.value){L.push("/");return}(i.value.chain==="KDA"||i.value.chain==="KDA_TESTNET")&&($.value=Number(i.value.kadena_chain_id??0),C.value.length>0&&(m.value=C.value[0])),V.value.length>0?n.value=V.value[0]:D.value.length>0&&(n.value=D.value[0]),document.addEventListener("click",ne)});const ne=t=>{const e=t.target;!e.closest(".chain-selector")&&!e.closest(".chain-dropdown")&&(k.value=!1),!e.closest(".token-selector")&&!e.closest(".token-dropdown")&&(p.value=!1),!e.closest(".address-book-btn")&&!e.closest(".address-book-dropdown")&&(g.value=!1)};return(t,e)=>(o(),l("div",he,[re(ve,{title:"Send Transaction"}),s("div",me,[s("div",fe,[s("div",pe,[e[8]||(e[8]=s("label",null,"Select Token",-1)),s("div",{class:"token-selector",onClick:e[1]||(e[1]=a=>p.value=!p.value)},[n.value?(o(),l("div",ke,[s("div",ge,[n.value.logo_url&&!n.value.imageError?(o(),l("img",{key:0,src:n.value.logo_url,alt:n.value.symbol,onError:e[0]||(e[0]=a=>R(n.value))},null,40,ye)):(o(),l("div",be,r(n.value.symbol.charAt(0)),1))]),s("div",Ce,[s("div",Te,r(n.value.symbol),1),s("div",Se,r(J(n.value.balance)),1)])])):(o(),l("div",we," Choose a token ")),s("i",{class:E(["ri-arrow-down-s-line dropdown-icon",{rotated:p.value}])},null,2)]),p.value?(o(),l("div",Ae,[(o(!0),l(N,null,F(D.value,a=>(o(),l("div",{key:a.token_address||"native",class:E(["token-option",{disabled:parseFloat(a.balance)===0}]),onClick:c=>Z(a)},[s("div",Ne,[a.logo_url&&!a.imageError?(o(),l("img",{key:0,src:a.logo_url,alt:a.symbol,onError:c=>R(a)},null,40,Fe)):(o(),l("div",Ie,r(a.symbol.charAt(0)),1))]),s("div",$e,[s("div",De,r(a.symbol),1),s("div",xe,r(a.name),1)]),s("div",Oe,r(J(a.balance)),1)],10,Ee))),128))])):v("",!0)]),s("div",Pe,[e[15]||(e[15]=s("label",null,"To Address",-1)),s("div",Le,[I(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),type:"text",placeholder:"Enter recipient address",class:"input-field"},null,512),[[P,u.value]]),s("button",{class:"address-book-btn",onClick:e[3]||(e[3]=a=>g.value=!g.value)},e[9]||(e[9]=[s("i",{class:"ri-at-line"},null,-1)]))]),g.value?(o(),l("div",Ke,[x.value.length>0?(o(),l("div",Ue,[e[11]||(e[11]=s("div",{class:"group-title"},"My Wallets",-1)),(o(!0),l(N,null,F(x.value,a=>(o(),l("div",{key:a.id,class:"address-option",onClick:c=>M(a.address,a.name)},[s("div",Be,[s("img",{src:a.avatar||Ts,alt:a.name},null,8,Je)]),s("div",Re,[s("div",Me,r(a.name),1),s("div",We,r(W(a.address)),1)]),e[10]||(e[10]=s("i",{class:"ri-wallet-line address-type-icon"},null,-1))],8,Ve))),128))])):v("",!0),O.value.length>0?(o(),l("div",je,[e[13]||(e[13]=s("div",{class:"group-title"},"Recent Addresses",-1)),(o(!0),l(N,null,F(O.value,a=>(o(),l("div",{key:a.address,class:"address-option",onClick:c=>M(a.address,a.name)},[s("div",He,[s("div",qe,r((a.name||a.address).charAt(0).toUpperCase()),1)]),s("div",ze,[s("div",Xe,r(a.name||"Unknown"),1),s("div",Qe,r(W(a.address)),1)]),e[12]||(e[12]=s("i",{class:"ri-history-line address-type-icon"},null,-1))],8,Ge))),128))])):v("",!0),x.value.length===0&&O.value.length===0?(o(),l("div",Ye,e[14]||(e[14]=[s("i",{class:"ri-contacts-line"},null,-1),s("div",null,"No saved addresses",-1)]))):v("",!0)])):v("",!0)])]),s("div",Ze,[s("div",es,[e[16]||(e[16]=s("label",null,"Amount",-1)),s("div",ss,[I(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),type:"number",step:"any",placeholder:"0.00",class:"amount-input",disabled:!n.value||parseFloat(n.value.balance)===0},null,8,as),[[P,d.value]]),n.value&&parseFloat(n.value.balance)>0?(o(),l("button",{key:0,onClick:se,class:"max-btn"}," MAX ")):v("",!0)]),n.value&&d.value?(o(),l("div",ts," ≈ $"+r(Q()),1)):v("",!0)]),U.value?(o(),l("div",ns,[s("div",ls,[s("label",os,[I(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a),type:"checkbox",class:"toggle-checkbox"},null,512),[[de,y.value]]),e[17]||(e[17]=s("span",{class:"toggle-slider"},null,-1)),e[18]||(e[18]=s("span",{class:"toggle-text"},"Enable Cross-Chain Transfer",-1))])]),y.value?(o(),l("div",is,[e[21]||(e[21]=s("label",null,"Target Chain",-1)),s("div",{class:"chain-selector",onClick:e[6]||(e[6]=a=>k.value=!k.value)},[s("div",rs,[e[19]||(e[19]=s("div",{class:"chain-icon"},[s("i",{class:"ri-link"})],-1)),s("div",ds,[s("div",cs,"Chain "+r(m.value),1),s("div",us,"Target chain "+r(m.value),1)])]),s("i",{class:E(["ri-arrow-down-s-line dropdown-icon",{rotated:k.value}])},null,2)]),k.value?(o(),l("div",vs,[(o(!0),l(N,null,F(C.value,a=>(o(),l("div",{key:a,onClick:c=>ee(a),class:E(["chain-option",{selected:m.value===a}])},[e[20]||(e[20]=s("div",{class:"chain-icon"},[s("i",{class:"ri-link"})],-1)),s("div",hs,[s("div",ms,"Chain "+r(a),1),s("div",fs,"Target chain "+r(a),1)]),m.value===a?(o(),l("i",ps)):v("",!0)],10,_s))),128))])):v("",!0)])):v("",!0)])):v("",!0),b.value?(o(),l("div",ks,[s("div",gs,[e[22]||(e[22]=s("span",null,"Estimated Fee",-1)),s("span",null,r(b.value)+" "+r(X()),1)])])):v("",!0),s("div",ys,[e[23]||(e[23]=s("label",null,"Payment Password",-1)),I(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>S.value=a),type:"password",placeholder:"Enter your payment password",class:"input-field"},null,512),[[P,S.value]])]),w.value?(o(),l("div",bs,r(w.value),1)):v("",!0),s("button",{onClick:te,disabled:!B.value,class:"send-button"},e[24]||(e[24]=[s("div",{class:"button-content"},[s("i",{class:"ri-send-plane-line"}),s("span",null,"Send Transaction")],-1)]),8,Cs)])])]))}}),$s=_e(Ss,[["__scopeId","data-v-20b2a27c"]]);export{$s as default};
