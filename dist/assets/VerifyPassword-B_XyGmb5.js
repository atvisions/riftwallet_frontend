import{d as f,u as P,r as c,o as y,e as w,i as o,G as p,h as _,K as S,C as V,A,M as b,n as g,f as u,y as I}from"./auth-DA2mZ09H.js";import{a as k,u as C,_ as R}from"./preload-helper-DTCqTb4O.js";import{A as W}from"./chrome-mock-BbAbqiJG.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"verify-password-page"},M={class:"header-section"},N={class:"app-name"},z={class:"form-section"},B={class:"input-group"},D={class:"input-wrapper"},T=["type"],q={key:0,class:"error-message"},F=["disabled"],G={key:0,class:"loading-spinner"},H={key:1},K=f({__name:"VerifyPassword",setup(O){console.log("🔐 VerifyPassword.vue - 页面开始加载"),console.log("🌐 当前环境信息:",{href:window.location.href,pathname:window.location.pathname,hash:window.location.hash,windowSize:{width:window.innerWidth,height:window.innerHeight}}),console.log("🔐 VerifyPassword.vue - 组件开始加载"),console.log("🌐 当前环境信息:",{href:window.location.href,pathname:window.location.pathname,windowSize:{width:window.innerWidth,height:window.innerHeight}});const n=C(),s=P(),t=k(),m=()=>{sessionStorage.removeItem("isVerifyingPassword")},l=c(""),r=c(!1),d=c(!1),i=c(""),v=async()=>{if(console.log("🔐 开始密码验证流程"),console.log("📝 输入的密码长度:",l.value.length),!l.value){console.log("❌ 密码为空，停止验证");return}try{d.value=!0,i.value="",console.log("🔄 调用 authStore.verifyPaymentPassword"),console.log("🏪 当前 authStore 状态:",{isAuthenticated:s.isAuthenticated,deviceId:s.deviceId,hasPaymentPassword:s.hasPaymentPassword,isPasswordSessionValid:s.isPasswordSessionValid});const a=await s.verifyPaymentPassword(l.value);console.log("✅ 密码验证结果:",a),a?(console.log("🎉 密码验证成功，检查钱包状态"),console.log("🔍 验证后的 authStore 状态:",{isAuthenticated:s.isAuthenticated,deviceId:s.deviceId,hasPaymentPassword:s.hasPaymentPassword,isPasswordSessionValid:s.isPasswordSessionValid}),await I(),await new Promise(e=>setTimeout(e,100)),s.isPasswordSessionValid||(console.warn("⚠️ 密码会话状态未正确更新，重新检查"),await s.checkPasswordSession(),await new Promise(e=>setTimeout(e,50))),console.log("📱 开始加载钱包列表"),await t.loadWallets(),console.log("📊 钱包加载完成，钱包数量:",t.wallets.length),console.log("🔄 最终状态检查:",{hasPaymentPassword:s.hasPaymentPassword,isPasswordSessionValid:s.isPasswordSessionValid,walletsCount:t.wallets.length}),m(),t.wallets.length>0?(console.log("🏠 有钱包，从密码验证页面跳转到首页"),await n.replace("/"),console.log("✅ 路由跳转完成")):(console.log("💼 没有钱包，从密码验证页面跳转到钱包选择页面"),await n.replace("/wallet-choice"),console.log("✅ 路由跳转完成"))):(console.log("❌ 密码验证失败"),i.value="Invalid password. Please try again.")}catch(a){console.error("💥 密码验证过程中发生错误:",a),i.value=a instanceof Error?a.message:"Verification failed"}finally{d.value=!1,console.log("�� 密码验证流程结束")}};return y(()=>{console.log("🔐 VerifyPassword.vue - 页面挂载完成"),console.log("🏪 挂载时的 authStore 状态:",{isAuthenticated:s.isAuthenticated,deviceId:s.deviceId,hasPaymentPassword:s.hasPaymentPassword,isPasswordSessionValid:s.isPasswordSessionValid}),console.log("📱 挂载时的 walletStore 状态:",{walletsCount:t.wallets.length,currentWallet:t.currentWallet}),console.log("🌐 挂载时的路由信息:",{currentRoute:n.currentRoute.value.path,query:n.currentRoute.value.query,params:n.currentRoute.value.params})}),(a,e)=>(u(),w("div",E,[o("div",M,[e[2]||(e[2]=o("div",{class:"logo-container"},[o("img",{src:R,alt:"Riftwallet",class:"logo"})],-1)),o("h1",N,p(_(W).NAME),1),e[3]||(e[3]=o("p",{class:"form-description"}," Enter your password to access your wallet ",-1))]),o("div",z,[o("form",{onSubmit:S(v,["prevent"]),class:"password-form"},[o("div",B,[e[4]||(e[4]=o("label",{for:"password"},"Password",-1)),o("div",D,[A(o("input",{id:"password","onUpdate:modelValue":e[0]||(e[0]=h=>l.value=h),type:r.value?"text":"password",placeholder:"Enter your password",class:g(["password-input",{error:i.value}]),autofocus:""},null,10,T),[[b,l.value]]),o("button",{type:"button",onClick:e[1]||(e[1]=h=>r.value=!r.value),class:"toggle-password"},[o("i",{class:g(r.value?"ri-eye-off-line":"ri-eye-line")},null,2)])]),i.value?(u(),w("div",q,p(i.value),1)):V("",!0)]),o("button",{type:"submit",disabled:!l.value||d.value,class:"submit-btn"},[d.value?(u(),w("div",G)):(u(),w("span",H,"Verify Password"))],8,F)],32)])]))}}),L=x(K,[["__scopeId","data-v-c234a1a1"]]);export{L as default};
