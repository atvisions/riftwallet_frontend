import{a as q,u as J}from"./auth-handler-CmfhYZP0.js";import{A as X,h as E}from"./chrome-mock-BbAbqiJG.js";import{R as Z}from"./ResponsiveLayout-bP3B-uVa.js";import{d as Q,r as f,c as y,o as ee,g as te,F as M,f as l,i as s,e as r,G as v,C as U,H as F,I as L,n as p}from"./auth-6eK4OsPi.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"page-header"},ne={class:"header-right"},ae={class:"filter-funnel"},le={key:0,class:"filter-menu"},re=["onClick"],ie=["disabled"],ue={class:"page-content"},ce={key:0,class:"loading-state"},de={key:1,class:"empty-state"},fe={key:2,class:"error-state"},ve={key:3,class:"transactions-list"},ge={class:"date-header"},me=["onClick"],he={class:"transaction-icon"},pe={class:"icon-container"},_e=["src","alt"],we={key:1,class:"default-icon"},ye={key:0,class:"ri-arrow-up-line"},ke={key:1,class:"ri-arrow-down-line"},be={key:2,class:"ri-exchange-line"},Ce={class:"transaction-info"},Te={class:"transaction-main"},Fe={class:"transaction-header"},Le={class:"transaction-type"},Se={class:"transaction-details"},De={class:"transaction-address"},$e={class:"transaction-meta"},Ae={class:"transaction-time"},Be={key:0,class:"loading-more"},Ne={key:1,class:"no-more"},xe=10,Ee=Q({__name:"History",setup(Me){const k=J(),I=q(),u=f([]),g=f(!1),_=f(""),b=f(1),S=f(0),m=f(!1),D=y(()=>u.value.length>=S.value),h=f("all"),w=f(!1),H=[{label:"All",value:"all"},{label:"Sent",value:"sent"},{label:"Received",value:"received"}],O=e=>{h.value=e,w.value=!1},C=y(()=>h.value==="all"?u.value:h.value==="sent"?u.value.filter(e=>d(e).toLowerCase()==="sent"):h.value==="received"?u.value.filter(e=>d(e).toLowerCase()==="received"):u.value),c=y(()=>I.currentWallet),Y=y(()=>{if(!C.value||C.value.length===0)return{};const e={};return C.value.forEach(t=>{const n=t.block_time||t.timestamp||t.created_at,a=z(n);e[a]||(e[a]=[]),e[a].push(t)}),e}),T=async(e=!1)=>{if(c.value&&!(g.value||m.value)){e?m.value=!0:g.value=!0,_.value="";try{const t=await fetch(`${X.API_BASE_URL}/wallets/${c.value.id}/transaction_history/?page=${b.value}&limit=${xe}`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=await t.json();if(!t.ok)throw new Error(n.message||"Failed to fetch transactions");S.value=n.total||0,e?u.value=[...u.value,...n.transactions||n||[]]:u.value=n.transactions||n||[]}catch(t){_.value=t instanceof Error?t.message:"Failed to load transactions",console.error("Failed to fetch transactions:",t)}finally{e?m.value=!1:g.value=!1}}},R=e=>{const t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<60&&!m.value&&!D.value&&(b.value++,T(!0))},$=()=>{b.value=1,T()},z=e=>{if(!e)return"Unknown date";const t=new Date(typeof e=="number"?e*1e3:e),n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=new Date(a.getTime()-24*60*60*1e3),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i.getTime()===a.getTime()?"Today":i.getTime()===o.getTime()?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==n.getFullYear()?"numeric":void 0})},A=e=>{if(e.token_logo&&e.token_logo.trim())return e.token_logo;const t=e.token_symbol||e.symbol||c.value?.chain;return t&&{SOL:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",ETH:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/info/logo.png",BNB:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/smartchain/info/logo.png",BASE:"/icons/icon128.png",KDA:"/icons/icon128.png",MATIC:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/polygon/info/logo.png",AVAX:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/avalanchec/info/logo.png",FTM:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/fantom/info/logo.png",USDC:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",USDT:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB/logo.png",BONK:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263/logo.png"}[t.toUpperCase()]||"/icons/icon128.png"},B=e=>e.token_symbol||e.symbol||c.value?.chain||"TOKEN",d=e=>e.type?e.type.charAt(0).toUpperCase()+e.type.slice(1):e.from_address&&c.value?e.from_address.toLowerCase()===c.value.address.toLowerCase()?"Sent":"Received":"Transaction",G=e=>{const t=e.target;t.src="/icons/icon128.png"},P=e=>{switch(d(e).toLowerCase()){case"send":return"amount-negative";case"receive":return"amount-positive";default:return"amount-neutral"}},j=e=>{const t=d(e),n=B(e);if(e.amount&&e.amount.toString().includes("Fee:"))return e.amount;if(e.amount&&e.amount!=="0"&&!isNaN(parseFloat(e.amount))){const a=parseFloat(e.amount),o=t.toLowerCase()==="sent"?"-":t.toLowerCase()==="received"?"+":"";let i="";return a>=.001?i=a.toFixed(6).replace(/\.?0+$/,""):a>0?i=a.toFixed(9).replace(/\.?0+$/,""):i="0",`${o}${i} ${n}`}if(e.value&&e.value!=="0"&&!isNaN(parseFloat(e.value))){const a=parseFloat(e.value),o=t.toLowerCase()==="sent"?"-":t.toLowerCase()==="received"?"+":"";let i="";return a>=.001?i=a.toFixed(6).replace(/\.?0+$/,""):a>0?i=a.toFixed(9).replace(/\.?0+$/,""):i="0",`${o}${i} ${n}`}return e.fee&&c.value?.chain==="SOL"?`Fee: ${(e.fee/1e9).toFixed(6)} SOL`:`0 ${n}`},K=e=>{if(!c.value)return"";if(e.signature&&c.value?.chain==="SOL")return E(e.signature);const t=d(e);let n="";return t.toLowerCase()==="send"?n=e.to_address||e.recipient||"":n=e.from_address||e.sender||"",n?E(n):"Unknown"},V=e=>{if(!e)return"Unknown time";const t=new Date(typeof e=="number"?e*1e3:e);if(isNaN(t.getTime()))return"Unknown time";const a=new Date().getTime()-t.getTime(),o=Math.floor(a/(1e3*60)),i=Math.floor(a/(1e3*60*60)),x=Math.floor(a/(1e3*60*60*24));return o<1?"Just now":o<60?`${o}m ago`:i<24?`${i}h ago`:x<7?`${x}d ago`:t.toLocaleDateString()},W=e=>{console.log("View transaction detail:",e)},N=()=>{try{console.log("🔙 处理交易历史页面返回"),window.history.length>1?k.go(-1):k.replace("/")}catch(e){console.error("返回操作失败:",e),k.replace("/")}};return ee(()=>{c.value&&T()}),(e,t)=>(l(),te(Z,{title:"Transaction History","show-header":!0,"show-footer":!1,scrollable:!0,onBack:N,onScroll:R},{header:M(()=>[s("div",oe,[s("div",{class:"header-left"},[s("button",{onClick:N,class:"back-button"},t[1]||(t[1]=[s("i",{class:"ri-arrow-left-line"},null,-1)])),t[2]||(t[2]=s("h1",{class:"header-title"},"Transaction History",-1))]),s("div",ne,[s("div",ae,[s("button",{class:"funnel-btn",onClick:t[0]||(t[0]=n=>w.value=!w.value)},t[3]||(t[3]=[s("i",{class:"ri-filter-3-line"},null,-1)])),w.value?(l(),r("div",le,[(l(),r(F,null,L(H,n=>s("div",{key:n.value,class:p(["filter-menu-item",{active:h.value===n.value}]),onClick:a=>O(n.value)},v(n.label),11,re)),64))])):U("",!0)]),s("button",{onClick:$,disabled:g.value,class:"refresh-button"},[s("i",{class:p(["ri-refresh-line",{spinning:g.value}])},null,2)],8,ie)])])]),default:M(()=>[s("div",ue,[g.value&&u.value.length===0?(l(),r("div",ce,t[4]||(t[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Loading transactions...",-1)]))):!g.value&&u.value.length===0?(l(),r("div",de,t[5]||(t[5]=[s("i",{class:"ri-history-line"},null,-1),s("h2",null,"No Transactions",-1),s("p",null,"Your transaction history will appear here",-1)]))):_.value?(l(),r("div",fe,[t[6]||(t[6]=s("i",{class:"ri-error-warning-line"},null,-1)),t[7]||(t[7]=s("h2",null,"Failed to Load",-1)),s("p",null,v(_.value),1),s("button",{onClick:$,class:"retry-button"}," Try Again ")])):(l(),r("div",ve,[(l(!0),r(F,null,L(Y.value,(n,a)=>(l(),r("div",{key:a,class:"transaction-group"},[s("div",ge,v(a),1),(l(!0),r(F,null,L(n,o=>(l(),r("div",{key:o.signature||o.id,class:"transaction-item",onClick:i=>W(o)},[s("div",he,[s("div",pe,[A(o)?(l(),r("img",{key:0,src:A(o),alt:B(o),class:"token-icon",onError:G},null,40,_e)):(l(),r("div",we,t[8]||(t[8]=[s("i",{class:"ri-coins-line"},null,-1)])))]),s("div",{class:p(["transaction-type-indicator",{"type-sent":d(o).toLowerCase()==="sent","type-received":d(o).toLowerCase()==="received"}])},[d(o).toLowerCase()==="sent"?(l(),r("i",ye)):d(o).toLowerCase()==="received"?(l(),r("i",ke)):(l(),r("i",be))],2)]),s("div",Ce,[s("div",Te,[s("div",Fe,[s("div",Le,v(d(o)),1),s("div",{class:p(["transaction-amount",P(o)])},v(j(o)),3)]),s("div",Se,[s("div",De,v(K(o)),1),s("div",$e,[s("span",Ae,v(V(o.block_time||o.timestamp||o.created_at)),1),s("span",{class:p(["status-badge",{"status-success":o.status==="success","status-failed":o.status==="failed","status-pending":o.status==="pending","status-unknown":!["success","failed","pending"].includes(o.status)}])},v(o.status?o.status.charAt(0).toUpperCase()+o.status.slice(1):"Unknown"),3)])])])])],8,me))),128))]))),128)),m.value?(l(),r("div",Be,"Loading more...")):D.value&&u.value.length>0?(l(),r("div",Ne,"No more records")):U("",!0)]))])]),_:1}))}}),Re=se(Ee,[["__scopeId","data-v-8cfafc8a"]]);export{Re as default};
